{"version":3,"file":"pathfinder-sdk_v1.0.0.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export function handleWindowError(_window, handleError, ctx) {\n  _window.onerror = (msg, url, line, col, error) => {\n    if (/Script error/.test(msg)) {\n      handleError({\n        title: 'Script error',\n        msg: 'Script error',\n        category: 'js',\n        level: 'error'\n      }, ctx);\n      return;\n    }\n    if (error && error.stack) {\n      handleError({\n        title: msg,\n        msg: error.stack,\n        category: 'js',\n        level: 'error'\n      }, ctx);\n    } else {\n      handleError({\n        title: msg,\n        msg: JSON.stringify({\n          resourceUrl: url,\n          rowNum: line,\n          colNum: col\n        }),\n        category: 'js',\n        level: 'error'\n      }, ctx);\n    }\n  }\n}\n\nexport function handleRejectedPromise(_window, handleError, ctx) {\n  _window.addEventListener('unhandledrejection', event => {\n    if (event) {\n      const reason = event.reason || '';\n      handleError({\n        title: 'unhandledrejection',\n        msg: reason,\n        category: 'js',\n        level: 'error'\n      }, ctx);\n    }\n  })\n}\n\nexport function handleResourceError(_window, handleError, ctx) {\n  _window.addEventListener('error', event => {\n    if (event) {\n      const target = event.target || event.srcElement;\n      const isResourceTarget = target instanceof HTMLScriptElement || target instanceof HTMLLinkElement || target instanceof HTMLImageElement;\n      // js error 不需要再处理\n      if (!isResourceTarget) return;\n      const url = target.src || target.href;\n      handleError({\n        title: target.nodeName,\n        msg: url,\n        category: 'resource',\n        level: 'error'\n      }, ctx);\n    }\n  }, true)\n}\n\nexport function handleConsoleError(_window, handleError, ctx) {\n  if (!_window.console || !_window.console.error) return;\n\n    _window.console.error = (...args) => {\n      handleError({\n        title: 'consoleError',\n        msg: JSON.stringify(args.join(',')),\n        category: 'js',\n        level: 'error'\n      }, ctx);\n    };\n}\n\nexport function handleVueError(_window, handleError, ctx) {\n  const vue = _window.Vue;\n  if (!vue || !vue.config) return;\n\n  const VueErrorHandler = (error, vm, info) => {\n    const metaData = {};\n    let isComponentError = false;\n    if (Object.prototype.toString.call(vm) === '[object Object]') {\n      metaData.componentName = vm._isVue ? vm.$options || vm.$options._componentTag : vm.name;\n      metaData.propsData = vm.$options.propsData;\n      if (metaData.componentName || metaData.propsData) {\n        isComponentError = true;\n      }\n    }\n    const errMsg = isComponentError ? metaData : error;\n    handleError({\n      title: `Vue Error: ${info}`,\n      msg: errMsg,\n      category: 'js',\n      level: 'error'\n    }, ctx);\n  };\n\n  Vue.config.errorHandler = VueErrorHandler;\n}\n","import {\n  handleWindowError,\n  handleRejectedPromise,\n  handleResourceError,\n  handleVueError\n} from './utils';\n\nclass Pathfinder {\n  constructor (options) {\n    this.errorStack = [];\n    this.initConfig(options);\n    this.setup();\n  }\n  static getInstance(options) {\n    if (!(this.instance instanceof this)) {\n      this.instance = new this(options)\n    }\n    return this.instance\n  }\n  initConfig(options) {\n    const defaultConfig = {\n      jsError: true,\n      resourceError: true,\n      consoleError: false, // console.error默认不处理\n      scriptError: false, // 跨域js错误，默认不处理，因为没有任何信息\n      vueError: true,\n      autoReport: true,\n      filters: [], // 过滤器，命中的不上报\n      levels: ['info', 'warning', 'error'],\n      category: ['js', 'resource', 'ajax']\n    }\n    this.config = {\n      ...defaultConfig,\n      ...options\n    }\n  }\n  setup() {\n    const _window = typeof window !== 'undefined'\n    ? window\n    : {};\n    this.registerError(_window);\n  }\n  registerError(_window) {\n    const { jsError, resourceError, vueError } = this.config;\n    if (jsError) {\n      handleWindowError(_window, this.handleError, this);\n      handleRejectedPromise(_window, this.handleError, this);\n    }\n    if (resourceError) {\n      handleResourceError(_window, this.handleError, this);\n    }\n    if (vueError) {\n      handleVueError(_window, this.handleError, this);\n    }\n  }\n  handleError(errorObj, ctx) {\n    const { autoReport } = ctx.config;\n    if (autoReport) {\n      ctx.sendError(errorObj);\n    }\n    // ctx.errorStack.push(errorObj);\n  }\n  sendError(errorObj) {\n    // TODO send error\n    console.log(\"Pathfinder -> sendError -> errorObj\", errorObj)\n  }\n}\n\nPathfinder.getInstance();\n"],"names":["handleWindowError","_window","handleError","ctx","onerror","msg","url","line","col","error","test","title","category","level","stack","JSON","stringify","resourceUrl","rowNum","colNum","handleRejectedPromise","addEventListener","event","reason","handleResourceError","target","srcElement","isResourceTarget","HTMLScriptElement","HTMLLinkElement","HTMLImageElement","src","href","nodeName","handleVueError","vue","Vue","config","VueErrorHandler","vm","info","metaData","isComponentError","Object","prototype","toString","call","componentName","_isVue","$options","_componentTag","name","propsData","errMsg","errorHandler","Pathfinder","options","errorStack","initConfig","setup","defaultConfig","jsError","resourceError","consoleError","scriptError","vueError","autoReport","filters","levels","window","registerError","errorObj","sendError","console","log","instance","getInstance"],"mappings":"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"}